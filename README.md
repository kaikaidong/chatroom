# chatroom
2021.11.23进度：完成技术选择，使用spring+netty+websocket技术实现聊天系统，搭建基本框架，实现登录前后端实现




### **简易聊天室设计：主要目标设计一个在线实时聊天系统**

#### 需求分析

1、【基本功能】支持单聊，即一对一单聊，可以标记不同用户身份，如客户和经理两种身份。
2、【基本功能】延迟提醒，即客户给经理发送消息后，经理在1分钟未回复，就提醒经理。尽量考虑后端支持分布式多点部署。
3、【基本功能】聊天内容，支持敏感词过滤，提示用户发送的内容是否包含敏感词。连续超过5次敏感词，用户当天不能发送消息，直到第二天。
4、【扩展功能】聊天控制，一个用户一天只能发送100条消息，发送消息后间隔3秒才能发送下一条，其中100和3可以配置。
5、【扩展功能】支持搜索，支持聊天文字信息的模糊匹配查询。
6、【扩展功能】支持群聊，即入群后，一个人发消息后，群中其它成员都可以收到消息

交付目标：
1、完成系统功能开发，并提供部署文档、进行演示
2、尽量满足系统设计功能点，越多越好。编程语言不限制，建议使用Java或Nodejs
3、可引用开源基础组件，但业务逻辑需自己实现
4、代码、文档需上传到github 上，工作日期间每天至少提交一次代码，周末不限
5、考察重点为后端实现，前端页面简单完成即可
6、课题时间：发布课题后的第二天开始，为期2周

#### 进度安排

第一周：搭建项目整体框架，实现核心功能：注册登录、单聊、群聊、聊天内容敏感词控制，前端页面简单实现

第二周：实现延迟提醒、聊天控制、搜索与及其他合适附加功能

#### 初步设计

1.技术选型：后端采用spring+netty+websocket

技术难点：传统web项目采用B/S架构存在两点问题：

* http是短连接，无状态的，一次请求完了服务器一次响应后就会断开连接；**
* 服务器端的 ip 是开放在公网的，所有人能访问；而客户端的 ip 是不开放的（服务端不知道），所以服务器端不能主动给客户端发送消息

基于以上问题选用websocket技术，双方通信都是全双工的，客户端和服务端都可以主动的收发消息。

下图为简单的系统架构图：最主要的过程是通过用户id建立一条WebSocket连接并保存在后端以便进行实时通信

![image-20211123161250844](https://github.com/dianbaer/anychat/blob/master/anychat.png?raw=true)

整个通信系统以Tomcat作为核心服务器运行，其下另开一个线程运行Netty WebSocket服务器，Tomcat服务器主要处理客户登录、个人信息管理等的HTTP类型请求。用户通过浏览器登录后，浏览器会维持一个Session对象来保持登录状态，Tomcat服务器会返回用户的个人信息，同时记录在线用户，根据用户id建立一条WebSocket连接并保存在后端以便进行实时通信。当一个用户向另一用户发起通信，服务器会根据消息内容中的对话方用户id，找到保存的WebSocket连接，通过该连接发送消息，对方就能够收到即时收到消息。当用户注销或退出时，释放WebSocket连接，清空Session对象中的登录状态。

#### 功能模块

1.数据库表设计

聊天系统中涉及用户信息表、群组信息表、好友信息表、聊天访问控制表（待确认），考虑聊天记录是否需要保存初始化时加载

2.登录模块

3.系统初始化加载好友列表和群组列表

4.单聊

5....

